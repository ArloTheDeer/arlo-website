# 產品需求文件 (PRD) - 筆記導覽側邊欄

**日期：** 2025-09-13  
**功能名稱：** 筆記導覽側邊欄 (Notes Navigation Sidebar)

## 簡介/概述

為筆記系統實作一個左側導覽側邊欄，讓使用者可以快速瀏覽所有筆記並在不同筆記之間切換。此功能將顯示在每篇筆記的頁面上，提供直觀的導覽體驗，讓訪問者能夠輕鬆探索和閱讀不同的筆記內容。

設計參考 Obsidian 的檔案瀏覽器，採用簡潔的樹狀目錄結構，支援資料夾折疊/展開，但會進行簡化以符合網站需求。

基於現有的筆記 URL 路由系統（`/notes/[...slug]`），此側邊欄將與目前的檔案結構和路由機制完全整合。

## 目標

1. **提升使用者體驗：** 讓訪問者能夠快速在筆記之間導覽，無需返回主頁或手動輸入 URL
2. **提供視覺化導覽：** 清楚顯示目前正在閱讀的筆記，並提供直觀的導覽結構
3. **響應式設計：** 在桌面和手機版本上都能良好運作

## 使用者故事

1. **作為訪問者**，我想要在閱讀筆記時看到所有可用的筆記列表，以便我可以探索其他相關內容。

2. **作為訪問者**，我想要點擊側邊欄中的筆記標題，以便快速跳轉到該筆記頁面。

3. **作為訪問者**，我想要清楚看到我目前正在閱讀哪篇筆記，以便保持導覽的方向感。

4. **作為手機使用者**，我想要能夠展開和收合側邊欄，以便在小螢幕上有更好的閱讀體驗。

5. **作為桌面使用者**，我想要能夠收合側邊欄，以便在需要更多閱讀空間時隱藏導覽欄。

## 功能需求

### 基本功能
1. **樹狀目錄結構：** 系統必須以樹狀結構顯示 `public/notes-src` 目錄下的所有資料夾和 `.md` 檔案
2. **資料夾折疊/展開：** 使用者必須能夠折疊和展開各個資料夾節點
3. **檔案名稱顯示：** 系統必須使用檔案名稱（去除 .md 副檔名）作為顯示名稱
4. **點擊導覽：** 使用者必須能夠點擊任何筆記項目來導覽到該筆記頁面
5. **目前頁面標示：** 系統必須高亮顯示目前正在閱讀的筆記項目，包括其所在的資料夾路徑

### 使用者介面
6. **左側定位：** 側邊欄必須位於頁面左側
7. **固定寬度：** 側邊欄在展開狀態下必須有固定的寬度（建議 280-320px）
8. **收合功能：** 使用者必須能夠收合和展開側邊欄
9. **收合按鈕：** 必須提供明顯的收合/展開按鈕或圖示
10. **層級縮排：** 子資料夾和檔案必須有適當的縮排來顯示層級關係
11. **展開/收合圖示：** 可展開的資料夾必須有三角形或類似的圖示來指示狀態

### 響應式設計
12. **桌面版展開：** 在桌面版本上，側邊欄預設為展開狀態
13. **手機版收合：** 在手機版本上，側邊欄預設為收合狀態
14. **手機版圖示：** 在手機版本上，必須顯示一個漢堡選單圖示或類似的展開按鈕
15. **覆蓋層模式：** 在手機版本上展開時，側邊欄必須以覆蓋層的形式出現

### 技術整合
16. **路由整合：** 系統必須與現有的 `/notes/[...slug]` 路由系統整合
17. **檔案掃描：** 系統必須使用現有的 `scanNotesFiles()` 函數來獲取筆記列表，並擴展以支援目錄結構
18. **URL 生成：** 系統必須正確生成每篇筆記的 URL 路徑
19. **中文檔名支援：** 系統必須支援包含中文字符的檔案名稱
20. **資料夾狀態記憶：** 系統必須能夠記住使用者折疊/展開的資料夾狀態（至少在當前會話中）

## 非目標（超出範圍）

1. **搜尋功能：** 第一版不包含搜尋或篩選功能
2. **筆記預覽：** 不提供筆記內容的預覽功能
3. **拖拽排序：** 不支援使用者自訂排序或重新組織檔案結構
4. **書籤功能：** 不包含收藏或書籤功能
5. **最近閱讀：** 不追蹤或顯示最近閱讀的筆記
6. **檔案操作：** 不支援重新命名、刪除或建立檔案的功能
7. **複雜動畫：** 保持簡潔，不實作複雜的動畫效果
8. **顏色分類：** 不使用不同顏色來區分資料夾類型，保持統一的視覺風格

## 設計考量

### 視覺設計
- 參考 Obsidian 的設計但進行簡化，保持清潔和現代的外觀
- 使用與現有頁面一致的設計語言和色彩方案
- 目前頁面的筆記項目應有明顯的視覺區別（如背景色、邊框等）
- 資料夾和檔案使用統一的視覺風格，透過圖示和縮排來區分層級
- 收合/展開動畫應平滑且不干擾閱讀體驗

### 使用者體驗
- 側邊欄的寬度不應影響主要內容的可讀性
- 在手機版本上，展開的側邊欄應該可以通過點擊外部區域來關閉
- 載入性能應該良好，筆記列表的生成不應顯著影響頁面載入速度

## 技術考量

### 現有系統整合
- 必須與現有的 `lib/notes.ts` 中的函數整合
- 需要與 Next.js 的靜態生成機制兼容
- 應該重用現有的路由邏輯和檔案路徑處理
- 需要擴展 `scanNotesFiles()` 函數以支援目錄樹狀結構

### 性能考量
- 筆記列表和目錄結構應該在伺服器端生成以提高性能
- 考慮實作客戶端狀態管理來記住側邊欄和資料夾的展開/收合狀態
- 確保檔案掃描不會在每次頁面載入時重複執行

### 安全性
- 必須遵循現有的安全措施（檔案路徑驗證、允許的目錄限制）
- 不應暴露系統檔案結構的敏感資訊
- 確保資料夾折疊/展開狀態不會暴露未授權的檔案路徑

## 開放問題

1. **狀態持久化：** 是否需要記住使用者的側邊欄和資料夾展開/收合偏好？
2. **載入指示器：** 是否需要在筆記列表載入時顯示載入狀態？
3. **錯誤處理：** 如何處理檔案讀取失敗或筆記標題提取失敗的情況？
4. **深層巢狀：** 如何處理過深的資料夾巢狀結構？
5. **檔案數量限制：** 是否需要對顯示的檔案數量設定上限？

## 參考資料

- 現有筆記路由實作：`app/notes/[...slug]/page.tsx`
- 筆記掃描工具：`lib/notes.ts`
- 筆記檔案結構：`public/notes-src/`
- 設計參考：`docs/specs/2025-09-13-notes-navigation-sidebar/screenshot.png` (Obsidian 檔案瀏覽器)