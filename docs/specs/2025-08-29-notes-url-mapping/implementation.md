# 實作計畫

## PRD 參考

**PRD 文件路徑：** `docs/specs/2025-08-29-notes-url-mapping/prd.md`

> **重要提醒：** 實作過程中請經常參考 PRD 文件以了解：
>
> - 功能的商業目標和用戶價值
> - 完整的用戶故事和使用場景
> - 非功能性需求（性能、安全性等）
> - 系統架構和技術決策的背景脈絡

## 相關檔案

- `lib/notes/fileScanner.ts` - 掃描 public/notes-src 目錄並發現所有 .md 檔案的工具函式
- `lib/notes/fileScanner.test.ts` - fileScanner 的單元測試檔案
- `lib/notes/pathUtils.ts` - URL 編碼/解碼和路徑處理的工具函式
- `lib/notes/pathUtils.test.ts` - pathUtils 的單元測試檔案
- `app/notes/[...slug]/page.tsx` - 動態路由頁面元件，處理所有筆記路徑
- `app/notes/[...slug]/page.test.tsx` - 筆記頁面元件的測試檔案
- `components/NoteContent.tsx` - 渲染筆記內容的 React 元件
- `components/NoteContent.test.tsx` - NoteContent 元件的測試檔案
- `next.config.ts` - Next.js 靜態輸出設定
- `acceptance.feature` - Gherkin 格式的驗收測試場景

## TDD 步驟執行指導

### 步驟 X.1：撰寫空的類別、函式並拋出未實作錯誤
- **目的：** 建立基本的程式碼結構，讓測試能夠通過型別檢查
- **重要原則：** 此階段不實作任何邏輯，只建立介面
- **錯誤格式：** 使用 `throw new Error('Not implemented')` 

### 步驟 X.2：撰寫測試敘述
- **目的：** 定義測試範圍，讓開發者確認測試的合理性
- **格式：** 使用 describe/it 結構（Vitest 語法）
- **測試範圍原則：** 專注在主流程和主要錯誤情境，不要鉅細靡遺地測試各種邊緣案例。邊緣案例應在發現問題後再逐漸加入
- **開發者確認：** **此步驟完成後必須暫停，等待開發者確認測試範圍**

### 步驟 X.3：實作測試邏輯
- **目的：** 實作具體的測試邏輯
- **執行時機：** 在開發者確認測試範圍後進行

### 步驟 X.4：執行測試，確保測試失敗（紅燈階段）
- **目的：** 驗證測試邏輯正確，確保在未實作時測試會失敗
- **預期結果：** 所有新增的測試都應該失敗
- **執行方式：** 使用 `npm test` 或 `npm run test`

### 步驟 X.5-X.7：原始實作要點
- **目的：** 實作原本任務中定義的功能邏輯
- **原則：** 保持原有的實作要點內容，按照原始順序執行
- **實作目標：** 讓步驟 X.4 中失敗的測試能夠通過

### 步驟 X.8：執行測試，確保測試成功（綠燈階段）
- **目的：** 驗證實作正確，確保所有測試都通過
- **預期結果：** 原本失敗的測試現在應該全部通過
- **執行方式：** 使用 `npm test` 或 `npm run test`

## 任務

- [ ] 1. 設定 Next.js 靜態輸出模式和基礎架構
  - [ ] 1.1 設定 next.config.ts 為靜態輸出模式（output: 'export'）
  - [ ] 1.2 移除現有樣板檔案（app/page.tsx, app/favicon.ico 等）
  - [ ] 1.3 建立基礎的應用程式結構和路由配置

- [ ] 2. 實作檔案掃描和路由生成邏輯
  - [ ] 2.1 撰寫空的類別、函式並拋出未實作錯誤
  - [ ] 2.2 撰寫測試敘述
  - [ ] 2.3 實作測試邏輯
  - [ ] 2.4 執行測試，確保測試失敗
  - [ ] 2.5 實作 fileScanner 掃描 public/notes-src 目錄功能
  - [ ] 2.6 建立檔案路徑到 URL 路徑的映射邏輯
  - [ ] 2.7 實作 generateStaticParams 來產生所有筆記路由
  - [ ] 2.8 執行測試，確保測試成功

- [ ] 3. 實作 URL 編碼和路徑處理
  - [ ] 3.1 撰寫空的類別、函式並拋出未實作錯誤
  - [ ] 3.2 撰寫測試敘述
  - [ ] 3.3 實作測試邏輯
  - [ ] 3.4 執行測試，確保測試失敗
  - [ ] 3.5 實作 URL 編碼/解碼功能（支援中文和特殊字符）
  - [ ] 3.6 處理檔案系統路徑和 URL 路徑之間的轉換
  - [ ] 3.7 確保 Windows 和 Unix 路徑格式的相容性
  - [ ] 3.8 執行測試，確保測試成功

- [ ] 4. 建立筆記頁面元件和內容渲染
  - [ ] 4.1 撰寫空的類別、函式並拋出未實作錯誤
  - [ ] 4.2 撰寫測試敘述
  - [ ] 4.3 實作測試邏輯
  - [ ] 4.4 執行測試，確保測試失敗
  - [ ] 4.5 建立動態路由頁面 app/notes/[...slug]/page.tsx
  - [ ] 4.6 實作 NoteContent 元件來渲染純文字內容
  - [ ] 4.7 整合檔案讀取和內容顯示邏輯
  - [ ] 4.8 執行測試，確保測試成功

- [ ] 5. 整合系統並驗證完整功能
  - [ ] 5.1 整合所有模組並確保靜態生成正常運作
  - [ ] 5.2 實作 404 頁面處理不存在的筆記路徑
  - [ ] 5.3 最佳化建置過程和效能調整

- [ ] 6. 執行驗收測試
  - 6.1 使用 AI 讀取 acceptance.feature 檔案
  - 6.2 透過指令或 MCP 瀏覽器操作執行每個場景
  - 6.3 驗證所有場景通過並記錄結果

## 測試設定說明

本專案使用 Vitest 作為測試框架，設定檔案位於 `vitest.config.mts`。主要特色：

- **測試環境：** jsdom（用於 React 元件測試）
- **測試工具：** @testing-library/react、@testing-library/jest-dom
- **路徑解析：** 支援 TypeScript 路徑映射
- **執行指令：** `npm test` 或 `npm run test`

## 成功標準

完成所有任務後，系統應該能夠：

1. **基本功能：** 網址 `/notes/00-journal/2025-08` 正確顯示對應筆記內容
2. **中文支援：** 正確處理包含中文的檔案名稱和 URL
3. **巢狀目錄：** 支援任意深度的目錄結構
4. **開發模式：** `npm run dev` 能正確呈現所有筆記內容
5. **靜態輸出：** `npm run build` 生成完整的靜態網站
6. **錯誤處理：** 不存在的路徑返回 404 頁面

## 注意事項

- **開發者確認：** 每個任務的步驟 X.2 完成後必須暫停等待確認
- **測試先行：** 嚴格遵循 TDD 紅燈→綠燈→重構的循環
- **漸進開發：** 專注主流程，邊緣案例後續再加入
- **文件參考：** 實作過程中持續參考 PRD 文件的需求和設計決策