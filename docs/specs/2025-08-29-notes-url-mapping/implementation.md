# 實作計畫

## PRD 參考

**PRD 文件路徑：** `docs/specs/2025-08-29-notes-url-mapping/prd.md`

> **重要提醒：** 實作過程中請經常參考 PRD 文件以了解：
>
> - 功能的商業目標和用戶價值
> - 完整的用戶故事和使用場景
> - 非功能性需求（性能、安全性等）
> - 系統架構和技術決策的背景脈絡

## 相關檔案

- `next.config.ts` - Next.js 設定檔，需要加入靜態輸出設定
- `app/notes/[...slug]/page.tsx` - 動態路由頁面元件（需要建立）
- `lib/notes.ts` - 筆記檔案掃描和處理工具（需要建立）
- `lib/path-utils.ts` - URL 編碼/解碼處理工具（需要建立）
- `app/not-found.tsx` - 404 頁面處理（需要建立或修改）
- `public/notes-src/**/*.md` - 現有的筆記檔案
- `acceptance.feature` - Gherkin 格式的驗收測試場景

## 任務

- [x] 1. 設定 Next.js 靜態輸出模式
  - 1.1 修改 `next.config.ts` 加入 `output: 'export'` 設定
  - 1.2 設定 `trailingSlash: true` 以支援靜態檔案結構
  - 1.3 測試基本的靜態建置功能

- [x] 2. 建立檔案掃描和路由生成工具 - 使用 TDD 開發流程
  - 2.1 實作 `lib/notes.ts` 中的檔案掃描功能，能夠遞迴掃描 `public/notes-src` 目錄
  - 2.2 實作路徑映射邏輯，將檔案路徑轉換為路由參數
  - 2.3 加入中文檔案名稱的處理和驗證
  - 2.4 實作 `generateStaticParams` 函數生成所有靜態路由

- [x] 3. 建立 URL 編碼處理工具 - 使用 TDD 開發流程
  - 3.1 實作 `lib/path-utils.ts` 中的 URL 編碼/解碼功能
  - 3.2 處理中文字符、空格和特殊符號的編碼轉換
  - 3.3 確保 URL 路徑與檔案系統路徑的正確對應
  - 3.4 加入跨平台路徑分隔符處理

- [x] 4. 實作動態筆記頁面元件 - 使用 TDD 開發流程
  - 4.1 建立 `app/notes/[...slug]/page.tsx` 動態路由頁面
  - 4.2 實作筆記內容讀取和純文字顯示邏輯
  - 4.3 加入適當的錯誤處理，包括檔案不存在的情況
  - 4.4 實作頁面標題和基本樣式設定

- [ ] 5. 建立 404 頁面處理
  - 5.1 建立或修改 `app/not-found.tsx` 處理不存在的筆記路徑
  - 5.2 設定適當的錯誤頁面樣式和使用者友善訊息
  - 5.3 確保 404 頁面在靜態建置後正常運作

- [ ] 6. 整合測試和驗證 - 使用 TDD 開發流程
  - 6.1 建立筆記功能的單元測試，包括路徑映射、檔案掃描和編碼處理
  - 6.2 建立整合測試驗證完整的筆記訪問流程
  - 6.3 測試中文檔案名稱和特殊字符的處理
  - 6.4 驗證靜態建置產生的檔案結構和內容正確性

- [ ] 7. 執行驗收測試
  - 7.1 使用 AI 讀取 acceptance.feature 檔案
  - 7.2 透過指令或 MCP 瀏覽器操作執行每個場景
  - 7.3 驗證所有場景通過並記錄結果