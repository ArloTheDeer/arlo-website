# 筆記網址映射功能 PRD

## 簡介/概述

本功能旨在建立一個筆記網站的基礎建設，讓所有存放在 `public/notes-src` 目錄下的 Markdown 檔案都能透過對應的網址正確訪問和渲染。例如，網址 `http://localhost/notes/00-journal/2025-08` 應該能夠渲染出 `public/notes-src/00-journal/2025-08.md` 的內容。此功能將完全採用靜態輸出，為之後的筆記網站奠定基礎。

## 目標

1. 建立完整的筆記檔案網址映射系統
2. 實現完全靜態化的網站輸出
3. 支援任意深度的目錄結構
4. 正確處理中文檔案名稱
5. 提供純文字形式的筆記內容渲染（暫不處理 Markdown 渲染）

## 使用者故事

1. **一般使用者**：作為網站訪問者，我希望能透過直觀的網址（如 `/notes/00-journal/2025-08`）訪問對應的筆記內容，以便快速找到我需要的資訊。

2. **內容建立者**：作為筆記撰寫者，我希望我在 `public/notes-src` 目錄下建立的任何 `.md` 檔案都能自動對應到相應的網址，無需手動設定路由。

3. **網站管理者**：作為網站維護者，我希望網站能完全靜態化輸出，以便更好地部署和效能最佳化。

## 功能需求

### 核心功能

1. **網址映射系統**：系統必須能將 `/notes/{path}` 格式的網址映射到 `public/notes-src/{path}.md` 檔案。

2. **靜態頁面生成**：系統必須在建置時為所有 `.md` 檔案生成對應的靜態 HTML 頁面。

3. **目錄結構支援**：系統必須支援任意深度的巢狀目錄結構（例如 `/notes/00-journal/thinking/思考五四三二一`）。

4. **中文檔案名稱支援**：系統必須正確處理包含中文字符的檔案名稱和路徑。

5. **文字內容渲染**：系統必須能以純文字格式顯示 Markdown 檔案的內容，暫不進行 Markdown 語法渲染。

6. **自動檔案探索**：系統必須能自動掃描 `public/notes-src` 目錄，發現所有 `.md` 檔案並為其生成路由。

### 技術需求

7. **Next.js 架構**：基於 Next.js 15.5.2 建立筆記系統，現有樣板檔案可移除重建。

8. **靜態輸出設定**：必須設定 Next.js 以完全靜態輸出模式運行。

9. **404 處理**：當訪問不存在的筆記路徑時，應正確返回 404 頁面。

## 非目標（超出範圍）

1. **Markdown 渲染**：本次不實作 Markdown 語法的視覺化渲染
2. **搜尋功能**：不包含筆記內容搜尋功能
3. **編輯功能**：不提供線上編輯筆記的功能
4. **使用者驗證**：所有內容皆為公開訪問，不需登入機制
5. **評論系統**：不包含對筆記的評論功能

## 技術考量

1. **全新架構建立**：基於 Next.js 15.5.2、React 19.1.0 建立全新的筆記系統，現有樣板代碼可完全移除
2. **檔案系統讀取**：需要在建置時讀取檔案系統來發現所有筆記檔案
3. **URL 編碼**：中文路徑需要正確的 URL 編碼/解碼處理
   - 瀏覽器 URL：使用 `encodeURIComponent()` 編碼中文字符和空格
   - 檔案系統：使用 `decodeURIComponent()` 解碼 URL 以對應實際檔案名稱
   - 範例：URL `/notes/20-area/Arlo%20The%20Deer%20%E8%A7%92%E8%89%B2%E8%A8%AD%E5%AE%9A` 對應檔案 `Arlo The Deer 角色設定.md`
4. **靜態生成**：使用 Next.js 的 `generateStaticParams` 和相關靜態生成功能
5. **檔案路徑處理**：需要處理 Windows 和 Unix 路徑差異

## 驗收標準

### 成功指標

1. **基本映射**：網址 `http://localhost/notes/00-journal/2025-08` 能正確顯示 `public/notes-src/00-journal/2025-08.md` 的內容

2. **巢狀目錄**：深層路徑如 `http://localhost/notes/30-resources/templates/Project Template` 能正確映射到對應檔案

3. **中文支援**：包含中文的路徑如 `http://localhost/notes/20-area/Arlo%20The%20Deer%20%E8%A7%92%E8%89%B2%E8%A8%AD%E5%AE%9A` （URL encoded）能正確顯示內容，並對應到 `Arlo The Deer 角色設定.md` 檔案

4. **靜態輸出**：執行 `npm run build` 後，所有筆記頁面都生成為靜態 HTML 檔案

5. **404 處理**：訪問不存在的筆記路徑時正確顯示 404 頁面

### 測試案例

1. 測試現有的所有筆記檔案都能正確訪問
2. 測試含有特殊字符（中文、空格）的檔案名稱
3. 測試多層巢狀目錄的檔案訪問
4. 測試靜態建置產生的檔案結構
5. 測試不存在檔案的 404 回應

## 開放問題

1. **建置最佳化**：大量筆記檔案對建置時間的影響需要評估
2. **快取策略**：靜態檔案的快取策略需要規劃
3. **特殊字符處理**：除了中文和空格，其他特殊字符（如括號、符號）的處理策略

## 實作優先序

1. **第一階段**：設定 Next.js 靜態輸出模式
2. **第二階段**：實作檔案掃描和路由生成邏輯
3. **第三階段**：建立筆記頁面元件和文字渲染
4. **第四階段**：處理中文路徑和特殊字符
5. **第五階段**：測試和最佳化

## 參考資料

- Next.js Static HTML Export 文件
- 現有專案架構：`package.json`、`next.config.ts`
- 筆記檔案結構：`public/notes-src/` 目錄